{% extends "base.html" %}
{% load static %}

{% block content %}
<section class="pt-32 pb-24 min-h-screen flex items-center bg-brand-white">
    <div class="max-w-4xl mx-auto px-6">
        
        <div class="text-center mb-12">
            <i data-lucide="credit-card" class="w-16 h-16 text-brand-accent mx-auto mb-6"></i>
            <h1 class="text-4xl md:text-5xl font-bold tracking-tighter text-brand-black mb-4">
                COMPLETA IL PAGAMENTO<span class="text-brand-accent">,</span>
            </h1>
            <p class="text-brand-gray text-lg max-w-2xl mx-auto">
                Completa il pagamento per confermare la tua prenotazione.
            </p>
        </div>
        
        <!-- Dettagli Appuntamento -->
        <div class="bg-brand-silver p-8 rounded max-w-lg mx-auto mb-8">
            <h3 class="font-bold text-brand-black mb-4 uppercase tracking-wider text-sm">Dettagli appuntamento</h3>
            <div class="space-y-2 text-brand-gray">
                <p><strong>Data:</strong> {{ appointment.date|date:"l d F Y" }}</p>
                <p><strong>Ora:</strong> {{ appointment.time|time:"H:i" }}</p>
                <p><strong>Nome:</strong> {{ appointment.first_name }} {{ appointment.last_name }}</p>
                <p><strong>Tipo:</strong> {% if appointment.consultation_type == 'video' %}Videochiamata{% else %}In presenza{% endif %}</p>
            </div>
            <div class="mt-6 pt-6 border-t border-brand-gray/20">
                <p class="text-2xl font-bold text-brand-black">
                    Importo: <span class="text-brand-accent">â‚¬{{ amount_due }}</span>
                </p>
            </div>
        </div>
        
        <!-- Metodo di Pagamento -->
        <div class="max-w-lg mx-auto">
            <h3 class="font-bold text-brand-black mb-6 uppercase tracking-wider text-sm text-center">Scegli metodo di pagamento</h3>
            
            <div class="space-y-4">
                {% if payment_method == 'stripe' %}
                <!-- Stripe Payment -->
                <form action="{% url 'booking:payment_link' appointment.pk %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="payment_method" value="stripe">
                    <button type="submit" class="w-full bg-[#635BFF] text-white font-bold uppercase tracking-widest px-8 py-4 hover:bg-[#4B45C6] transition-colors flex items-center justify-center gap-3">
                        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M13.976 9.15c-2.172-.806-3.356-1.426-3.356-2.409 0-.831.683-1.305 1.901-1.305 2.227 0 4.515.858 6.09 1.631l.89-5.494C18.252.975 15.697 0 12.165 0 9.667 0 7.589.654 6.104 1.872 4.56 3.147 3.757 4.992 3.757 7.218c0 4.039 2.467 5.76 6.476 7.219 2.585.939 3.426 1.619 3.426 2.652 0 .933-.784 1.524-2.253 1.524-1.903 0-4.641-.676-6.676-1.803L3.89 22.406c1.747.923 4.874 1.594 7.693 1.594 2.654 0 4.863-.651 6.407-1.87 1.675-1.321 2.49-3.265 2.49-5.594.001-4.082-2.494-5.823-6.504-7.386z"/>
                        </svg>
                        Paga con Carta
                    </button>
                </form>
                {% elif payment_method == 'paypal' %}
                <!-- PayPal Payment -->
                <form action="{% url 'booking:payment_link' appointment.pk %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="payment_method" value="paypal">
                    <button type="submit" class="w-full bg-[#0070BA] text-white font-bold uppercase tracking-widest px-8 py-4 hover:bg-[#003087] transition-colors flex items-center justify-center gap-3">
                        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M7.076 21.337H2.47a.641.641 0 0 1-.633-.74L4.944.901C5.026.382 5.474 0 5.998 0h7.46c2.57 0 4.578.543 5.69 1.81 1.01 1.15 1.304 2.42 1.012 4.287-.023.143-.047.288-.077.437-.983 5.05-4.349 6.797-8.647 6.797h-2.19c-.524 0-.968.382-1.05.9l-1.12 7.106zm14.146-14.42a3.35 3.35 0 0 0-.607-.541c-.013.076-.026.175-.041.254-.59 3.025-2.566 4.643-5.813 4.643h-2.189c-.988 0-1.831.722-1.986 1.7l-1.12 7.106a.642.642 0 0 0 .633.74h3.065l.77-4.88c.082-.523.523-.9 1.05-.9h.653c4.04 0 7.186-1.637 8.11-6.374.312-1.6.11-2.893-.525-3.748z"/>
                        </svg>
                        Paga con PayPal
                    </button>
                </form>
                {% else %}
                <!-- Entrambi i metodi disponibili -->
                <form action="{% url 'booking:payment_link' appointment.pk %}" method="post" class="space-y-4">
                    {% csrf_token %}
                    
                    <button type="submit" name="payment_method" value="stripe" class="w-full bg-[#635BFF] text-white font-bold uppercase tracking-widest px-8 py-4 hover:bg-[#4B45C6] transition-colors flex items-center justify-center gap-3">
                        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M13.976 9.15c-2.172-.806-3.356-1.426-3.356-2.409 0-.831.683-1.305 1.901-1.305 2.227 0 4.515.858 6.09 1.631l.89-5.494C18.252.975 15.697 0 12.165 0 9.667 0 7.589.654 6.104 1.872 4.56 3.147 3.757 4.992 3.757 7.218c0 4.039 2.467 5.76 6.476 7.219 2.585.939 3.426 1.619 3.426 2.652 0 .933-.784 1.524-2.253 1.524-1.903 0-4.641-.676-6.676-1.803L3.89 22.406c1.747.923 4.874 1.594 7.693 1.594 2.654 0 4.863-.651 6.407-1.87 1.675-1.321 2.49-3.265 2.49-5.594.001-4.082-2.494-5.823-6.504-7.386z"/>
                        </svg>
                        Paga con Carta
                    </button>
                    
                    <div class="text-center text-brand-gray text-sm">oppure</div>
                    
                    <button type="submit" name="payment_method" value="paypal" class="w-full bg-[#0070BA] text-white font-bold uppercase tracking-widest px-8 py-4 hover:bg-[#003087] transition-colors flex items-center justify-center gap-3">
                        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M7.076 21.337H2.47a.641.641 0 0 1-.633-.74L4.944.901C5.026.382 5.474 0 5.998 0h7.46c2.57 0 4.578.543 5.69 1.81 1.01 1.15 1.304 2.42 1.012 4.287-.023.143-.047.288-.077.437-.983 5.05-4.349 6.797-8.647 6.797h-2.19c-.524 0-.968.382-1.05.9l-1.12 7.106zm14.146-14.42a3.35 3.35 0 0 0-.607-.541c-.013.076-.026.175-.041.254-.59 3.025-2.566 4.643-5.813 4.643h-2.189c-.988 0-1.831.722-1.986 1.7l-1.12 7.106a.642.642 0 0 0 .633.74h3.065l.77-4.88c.082-.523.523-.9 1.05-.9h.653c4.04 0 7.186-1.637 8.11-6.374.312-1.6.11-2.893-.525-3.748z"/>
                        </svg>
                        Paga con PayPal
                    </button>
                </form>
                {% endif %}
            </div>
        </div>
        
    </div>
</section>
{% endblock %}
