{% extends "wagtailadmin/base.html" %}
{% load wagtailadmin_tags %}

{% block titletag %}Invia Link Pagamento{% endblock %}

{% block content %}
<header class="w-header">
    <div class="w-container">
        <h1 class="w-header__title" id="header-title">
            <svg class="icon icon-mail" aria-hidden="true"><use href="#icon-mail"></use></svg>
            Invia Link Pagamento
        </h1>
    </div>
</header>

<div class="w-container">
    <div class="w-panel">
        <div class="w-panel__content">
            <div style="background: #eff6ff; border: 1px solid #bfdbfe; padding: 1.5rem; border-radius: 0.5rem; margin-bottom: 1.5rem;">
                <p style="color: #1e40af; margin: 0;">
                    üìß Invieremo un'email a <strong>{{ appointment.email }}</strong> con il link per completare il pagamento.
                </p>
            </div>
            
            <div style="background: #f3f4f6; padding: 1.5rem; border-radius: 0.5rem; margin-bottom: 1.5rem;">
                <h3 style="margin: 0 0 1rem 0; font-size: 1rem; text-transform: uppercase; letter-spacing: 0.05em;">
                    Dettagli Appuntamento
                </h3>
                <dl style="margin: 0; display: grid; grid-template-columns: auto 1fr; gap: 0.5rem 1rem;">
                    <dt style="font-weight: 600;">Cliente:</dt>
                    <dd style="margin: 0;">{{ appointment.first_name }} {{ appointment.last_name }}</dd>
                    
                    <dt style="font-weight: 600;">Data:</dt>
                    <dd style="margin: 0;">{{ appointment.date|date:"l d F Y" }}</dd>
                    
                    <dt style="font-weight: 600;">Ora:</dt>
                    <dd style="margin: 0;">{{ appointment.time|time:"H:i" }}</dd>
                    
                    <dt style="font-weight: 600;">Servizio:</dt>
                    <dd style="margin: 0;">
                        {% if appointment.service %}
                            {{ appointment.service.nome }} - ‚Ç¨{{ appointment.service.prezzo }}
                        {% else %}
                            Consulenza - ‚Ç¨60,00
                        {% endif %}
                    </dd>
                </dl>
            </div>
            
            <form method="post">
                {% csrf_token %}
                
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">
                        Metodo di pagamento
                    </label>
                    <p style="color: #6b7280; font-size: 0.875rem; margin: 0 0 0.75rem 0;">
                        Scegli il metodo di pagamento che verr√† proposto al cliente.
                    </p>
                    
                    <div style="display: flex; gap: 1rem;">
                        {% for value, label in payment_methods %}
                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1rem; background: white; border: 2px solid #e5e7eb; border-radius: 0.5rem; cursor: pointer;">
                            <input type="radio" name="payment_method" value="{{ value }}" 
                                   {% if appointment.payment_method == value or forloop.first %}checked{% endif %}>
                            {{ label }}
                        </label>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- Captcha matematico -->
                <div style="background: #fef3c7; border: 1px solid #fcd34d; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1.5rem;">
                    <label style="display: block; font-weight: 600; color: #92400e; margin-bottom: 0.5rem;">
                        üîê Verifica di sicurezza
                    </label>
                    <p style="color: #78350f; font-size: 0.875rem; margin: 0 0 0.75rem 0;">
                        Per confermare l'invio, risolvi questa operazione:
                    </p>
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <span style="font-size: 1.25rem; font-weight: 600; color: #78350f;">
                            {{ num1 }} + {{ num2 }} =
                        </span>
                        <input type="hidden" name="expected_result" value="{{ expected_result }}">
                        <input type="number" name="captcha_result" required
                               style="width: 80px; padding: 0.5rem; font-size: 1.25rem; text-align: center; border: 2px solid #fcd34d; border-radius: 0.375rem;"
                               placeholder="?">
                    </div>
                </div>
                
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <a href="{% url 'wagtailsnippets_booking_appointment:edit' appointment.pk %}" 
                       class="button button-secondary">
                        Annulla
                    </a>
                    <button type="submit" class="button button--icon">
                        <svg class="icon icon-mail" aria-hidden="true"><use href="#icon-mail"></use></svg>
                        Invia Link
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
