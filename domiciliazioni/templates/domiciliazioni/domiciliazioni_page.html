{% extends "base.html" %}
{% load wagtailcore_tags %}

{% block content %}
<section class="pt-32 pb-12 bg-brand-white border-b border-brand-gray/20">
    <div class="max-w-7xl mx-auto px-6">
        <h1 class="text-5xl md:text-7xl font-bold tracking-tighter text-brand-black mb-8">
            DOMICILIAZIONI<span class="text-brand-accent">,</span>
        </h1>
        {% if page.intro %}
        <div class="text-brand-gray text-lg max-w-3xl">
            {{ page.intro|richtext }}
        </div>
        {% endif %}
    </div>
</section>

<section class="py-16 bg-brand-silver">
    <div class="max-w-7xl mx-auto px-6">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <!-- Tribunali coperti -->
            <div class="lg:col-span-5 bg-brand-white p-8 border border-brand-gray/20">
                <h3 class="text-xl font-bold text-brand-black mb-6 uppercase tracking-wider">
                    <i data-lucide="scale" class="inline w-5 h-5 text-brand-accent mr-2"></i>
                    Tribunali coperti
                </h3>
                <ul class="space-y-3">
                    {% for tribunale in page.get_tribunali_list %}
                    <li class="flex items-center text-brand-gray">
                        <i data-lucide="check" class="w-4 h-4 text-brand-accent mr-2"></i>
                        {{ tribunale }}
                    </li>
                    {% empty %}
                    <li class="flex items-center text-brand-gray">
                        <i data-lucide="check" class="w-4 h-4 text-brand-accent mr-2"></i>Tribunale di Lecce
                    </li>
                    {% endfor %}
                </ul>
            </div>
            
            <!-- Descrizione servizio -->
            <div class="lg:col-span-7 bg-brand-white p-8 border border-brand-gray/20">
                <h3 class="text-xl font-bold text-brand-black mb-6 uppercase tracking-wider">Il servizio</h3>
                {% if page.service_description %}
                <div class="text-brand-gray prose">
                    {{ page.service_description|richtext }}
                </div>
                {% else %}
                <p class="text-brand-gray">
                    Il servizio di domiciliazione legale consente ai colleghi avvocati di essere rappresentati 
                    nelle udienze presso il Tribunale di Lecce, con la garanzia di 
                    un'assistenza professionale e puntuale.
                </p>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<section class="py-16 bg-brand-white">
    <div class="max-w-4xl mx-auto px-6">
        <h2 class="text-3xl font-bold text-brand-black mb-8 uppercase tracking-wider">
            Richiedi domiciliazione
        </h2>
        
        <form action="{{ page.url }}" method="POST" enctype="multipart/form-data" class="space-y-8" id="domiciliazione-form">
            {% csrf_token %}
            
            <!-- Dati Avvocato -->
            <div class="bg-brand-silver p-6 border border-brand-gray/20">
                <h3 class="text-lg font-bold text-brand-black mb-6 uppercase tracking-wider flex items-center gap-2">
                    <i data-lucide="user" class="w-5 h-5 text-brand-accent"></i>
                    Dati Avvocato
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs uppercase tracking-widest text-brand-gray mb-2">
                            Nome e Cognome <span class="text-brand-accent">*</span>
                        </label>
                        <input type="text" name="nome_avvocato" required
                            class="w-full bg-white border border-brand-gray/30 px-4 py-3 text-brand-black focus:outline-none focus:border-brand-accent transition-colors"
                            placeholder="Avv. Mario Rossi">
                    </div>
                    <div>
                        <label class="block text-xs uppercase tracking-widest text-brand-gray mb-2">
                            Ordine di appartenenza
                        </label>
                        <input type="text" name="ordine_appartenenza"
                            class="w-full bg-white border border-brand-gray/30 px-4 py-3 text-brand-black focus:outline-none focus:border-brand-accent transition-colors"
                            placeholder="Ordine Avvocati di Roma">
                    </div>
                    <div>
                        <label class="block text-xs uppercase tracking-widest text-brand-gray mb-2">
                            Email <span class="text-brand-accent">*</span>
                        </label>
                        <input type="email" name="email" required
                            class="w-full bg-white border border-brand-gray/30 px-4 py-3 text-brand-black focus:outline-none focus:border-brand-accent transition-colors"
                            placeholder="avv.rossi@email-studio.ext">
                    </div>
                    <div>
                        <label class="block text-xs uppercase tracking-widest text-brand-gray mb-2">
                            Telefono
                        </label>
                        <input type="tel" name="telefono"
                            class="w-full bg-white border border-brand-gray/30 px-4 py-3 text-brand-black focus:outline-none focus:border-brand-accent transition-colors"
                            placeholder="+39 333 1234567">
                    </div>
                </div>
            </div>
            
            <!-- Attività richiesta -->
            <div class="bg-brand-silver p-6 border border-brand-gray/20">
                <h3 class="text-lg font-bold text-brand-black mb-6 uppercase tracking-wider flex items-center gap-2">
                    <i data-lucide="scale" class="w-5 h-5 text-brand-accent"></i>
                    Attività richiesta
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs uppercase tracking-widest text-brand-gray mb-2">
                            Tribunale / Ufficio <span class="text-brand-accent">*</span>
                        </label>
                        <select name="tribunale" id="tribunale-select" required
                            class="w-full bg-white border border-brand-gray/30 px-4 py-3 text-brand-black focus:outline-none focus:border-brand-accent transition-colors">
                            <option value="">-- Seleziona --</option>
                            <option value="lecce">Tribunale di Lecce</option>
                            <option value="unep">Ufficio UNEP di Lecce</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs uppercase tracking-widest text-brand-gray mb-2">
                            Servizio <span class="text-brand-accent">*</span>
                        </label>
                        <select name="tipo_udienza" id="servizio-select" required
                            class="w-full bg-white border border-brand-gray/30 px-4 py-3 text-brand-black focus:outline-none focus:border-brand-accent transition-colors">
                            <option value="">Seleziona servizio...</option>
                            <option value="civile">Udienza Civile</option>
                            <option value="penale">Udienza Penale</option>
                            <option value="lavoro">Udienza Lavoro</option>
                            <option value="famiglia">Udienza Famiglia</option>
                            <option value="esecuzioni">Esecuzioni</option>
                            <option value="fallimentare">Fallimentare</option>
                            <option value="volontaria">Volontaria Giurisdizione</option>
                            <option value="notificazioni">Ufficio notificazioni</option>
                            <option value="esecuzione_protesti">Ufficio esecuzione e protesti</option>
                            <option value="altro">Altro</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs uppercase tracking-widest text-brand-gray mb-2">
                            Sezione
                        </label>
                        <input type="text" name="sezione"
                            class="w-full bg-white border border-brand-gray/30 px-4 py-3 text-brand-black focus:outline-none focus:border-brand-accent transition-colors"
                            placeholder="Es: Sezione Civile, III Sezione Penale">
                    </div>
                    <div>
                        <label class="block text-xs uppercase tracking-widest text-brand-gray mb-2">
                            Giudice
                        </label>
                        <input type="text" name="giudice"
                            class="w-full bg-white border border-brand-gray/30 px-4 py-3 text-brand-black focus:outline-none focus:border-brand-accent transition-colors"
                            placeholder="Dott.ssa / Dott. ...">
                    </div>
                </div>
            </div>
            
            <!-- Dati Causa -->
            <div class="bg-brand-silver p-6 border border-brand-gray/20">
                <h3 class="text-lg font-bold text-brand-black mb-6 uppercase tracking-wider flex items-center gap-2">
                    <i data-lucide="file-text" class="w-5 h-5 text-brand-accent"></i>
                    Dati Causa
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div id="numero-rg-container">
                        <label class="block text-xs uppercase tracking-widest text-brand-gray mb-2">
                            Numero R.G. <span class="text-brand-accent rg-required">*</span>
                        </label>
                        <input type="text" name="numero_rg" id="numero-rg-input"
                            class="w-full bg-white border border-brand-gray/30 px-4 py-3 text-brand-black focus:outline-none focus:border-brand-accent transition-colors"
                            placeholder="Es: 1234/2025">
                    </div>
                    <div>
                        <label class="block text-xs uppercase tracking-widest text-brand-gray mb-2">
                            Parti in causa
                        </label>
                        <input type="text" name="parti_causa"
                            class="w-full bg-white border border-brand-gray/30 px-4 py-3 text-brand-black focus:outline-none focus:border-brand-accent transition-colors"
                            placeholder="Rossi c/ Bianchi">
                    </div>
                    <div id="data-udienza-container">
                        <label class="block text-xs uppercase tracking-widest text-brand-gray mb-2">
                            Data udienza <span class="text-brand-accent data-required">*</span>
                        </label>
                        <input type="date" name="data_udienza" id="data-udienza-input"
                            class="w-full bg-white border border-brand-gray/30 px-4 py-3 text-brand-black focus:outline-none focus:border-brand-accent transition-colors">
                    </div>
                    <div>
                        <label class="block text-xs uppercase tracking-widest text-brand-gray mb-2">
                            Ora udienza
                        </label>
                        <input type="time" name="ora_udienza"
                            class="w-full bg-white border border-brand-gray/30 px-4 py-3 text-brand-black focus:outline-none focus:border-brand-accent transition-colors">
                    </div>
                </div>
            </div>
            
            <!-- Attività e Note -->
            <div class="bg-brand-silver p-6 border border-brand-gray/20">
                <h3 class="text-lg font-bold text-brand-black mb-6 uppercase tracking-wider flex items-center gap-2">
                    <i data-lucide="clipboard-list" class="w-5 h-5 text-brand-accent"></i>
                    Attività Richieste
                </h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs uppercase tracking-widest text-brand-gray mb-2">
                            Attività da svolgere in udienza <span class="text-brand-accent">*</span>
                        </label>
                        <textarea name="attivita_richieste" rows="3" required
                            class="w-full bg-white border border-brand-gray/30 px-4 py-3 text-brand-black focus:outline-none focus:border-brand-accent transition-colors"
                            placeholder="Es: Mera comparizione, deposito memoria ex art. 183 c.p.c., richiesta rinvio..."></textarea>
                    </div>
                    <div>
                        <label class="block text-xs uppercase tracking-widest text-brand-gray mb-2">
                            Note e istruzioni particolari <span class="text-brand-accent">*</span>
                        </label>
                        <textarea name="note" rows="3" required
                            class="w-full bg-white border border-brand-gray/30 px-4 py-3 text-brand-black focus:outline-none focus:border-brand-accent transition-colors"
                            placeholder="Eventuali istruzioni specifiche..."></textarea>
                    </div>
                </div>
            </div>
            
            <!-- Upload documenti -->
            <div class="bg-brand-silver p-6 border border-brand-gray/20">
                <h3 class="text-lg font-bold text-brand-black mb-6 uppercase tracking-wider flex items-center gap-2">
                    <i data-lucide="paperclip" class="w-5 h-5 text-brand-accent"></i>
                    Documenti Allegati
                </h3>
                <div>
                    <div class="border-2 border-dashed border-brand-gray/30 p-6 text-center hover:border-brand-accent transition-colors cursor-pointer"
                         onclick="document.getElementById('documents-input').click()">
                        <input type="file" id="documents-input" name="documents" multiple
                            class="hidden" accept=".pdf,.doc,.docx,.odt,.txt,.jpg,.jpeg,.png"
                            onchange="updateFileList(this)">
                        <i data-lucide="upload" class="w-8 h-8 mx-auto mb-3 text-brand-gray"></i>
                        <p class="text-sm text-brand-gray">Clicca o trascina i documenti qui</p>
                        <p class="text-xs text-brand-gray/60 mt-2">Procura, atti, memorie, documenti utili</p>
                        <p class="text-xs text-brand-gray/60">Formati: PDF, DOC, DOCX, ODT, TXT, JPG, PNG (max 10MB per file)</p>
                    </div>
                    <div id="file-list" class="mt-3 space-y-1"></div>
                </div>
            </div>
            
            <button type="submit" class="w-full bg-brand-accent text-white font-bold uppercase tracking-widest px-8 py-4 hover:bg-brand-black transition-colors flex items-center justify-center gap-2">
                <i data-lucide="send" class="w-5 h-5"></i>
                Invia richiesta domiciliazione
            </button>
        </form>
    </div>
</section>

<script>
function updateFileList(input) {
    const fileList = document.getElementById('file-list');
    fileList.innerHTML = '';
    
    Array.from(input.files).forEach(file => {
        const div = document.createElement('div');
        div.className = 'flex items-center gap-2 text-sm text-brand-gray bg-white px-3 py-2';
        div.innerHTML = `
            <i data-lucide="file" class="w-4 h-4 text-brand-accent"></i>
            <span>${file.name}</span>
            <span class="text-xs text-brand-gray/60">(${(file.size / 1024 / 1024).toFixed(2)} MB)</span>
        `;
        fileList.appendChild(div);
    });
    
    // Reinizializza icone Lucide
    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }
}

// Logica condizionale per campi obbligatori
document.addEventListener('DOMContentLoaded', function() {
    const tribunaleSelect = document.getElementById('tribunale-select');
    const numeroRgInput = document.getElementById('numero-rg-input');
    const dataUdienzaInput = document.getElementById('data-udienza-input');
    const rgRequired = document.querySelector('.rg-required');
    const dataRequired = document.querySelector('.data-required');
    
    function updateRequiredFields() {
        const isTribunale = tribunaleSelect.value === 'lecce';
        
        if (isTribunale) {
            numeroRgInput.setAttribute('required', 'required');
            dataUdienzaInput.setAttribute('required', 'required');
            rgRequired.style.display = 'inline';
            dataRequired.style.display = 'inline';
        } else {
            numeroRgInput.removeAttribute('required');
            dataUdienzaInput.removeAttribute('required');
            rgRequired.style.display = 'none';
            dataRequired.style.display = 'none';
        }
    }
    
    tribunaleSelect.addEventListener('change', updateRequiredFields);
    
    // Esegui all'avvio
    updateRequiredFields();
});
</script>
{% endblock %}